# Copy the working parts from the original file and create a clean version
# This will be the new scanner_discovery.py with proper function decomposition

# First, let me copy all the imports and helper functions from the original file